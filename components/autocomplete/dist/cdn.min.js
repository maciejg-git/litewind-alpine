(()=>{function a(t){t.data("autocomplete",()=>{let l={main:{"x-id"(){return["select-aria"]}},trigger:{role:"combobox",":aria-expanded"(){return this._isOpen},":aria-controls"(){return this.$id("select-aria")}},menu:{":id"(){return this.$id("select-aria")},role:"listbox"},option:{role:"option",":aria-selected"(){return this._selected.has(this.item.value)?"true":"false"}}},n=e=>e.offsetTop+e.clientHeight>e.parentElement.scrollTop+e.parentElement.clientHeight,h=e=>e.offsetTop<e.parentElement.scrollTop,r=e=>{e.parentElement.scrollTo(0,e.offsetTop-e.parentElement.clientHeight/2+e.clientHeight/2)},o=(e,i,s)=>(s=s||"match",(e+"").replace(new RegExp(`(${i.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")})`,"i"),`<span class='${s}'>$1</span>`));return{_isOpen:!1,_floating:null,_value:"",_externalValue:"",_selected:new Map,_selectItems:[],_filteredItems:[],_model:null,_highlightedIndex:-1,_selectEl:null,_isFocused:!1,_inputEl:null,_items:[],_multiple:!1,_itemText:"text",_itemValue:"value",_noFilter:!1,_noEmptyOpen:!1,init(){this.$nextTick(()=>{t.effect(()=>{this._items=t.bound(this.$el,"data-items")??this._items,this.transformItems(),this._highlightedIndex=-1}),this._multiple=JSON.parse(t.bound(this.$el,"data-multiple")??this._multiple),this._itemText=t.bound(this.$el,"data-item-text")??this._itemText,this._itemValue=t.bound(this.$el,"data-item-value")??this._itemValue,this._noFilter=JSON.parse(t.bound(this.$el,"data-no-filter")??this._noFilter),this._noEmptyOpen=JSON.parse(t.bound(this.$el,"data-no-empty-open")??this._noEmptyOpen),this._floating=useFloating(this.$refs.trigger||this.$root.querySelector("[x-bind='trigger']"),this.$refs.menu,{resize:!0})}),this._selectEl=this.$el,this._inputEl=this.$el.querySelector("[x-bind='input']"),t.bind(this.$el,{"x-modelable":"_model",async"@keydown.prevent.down"(){if(this.canOpenEmptyMenu()&&(this.open(),await this.$nextTick()),this._highlightedIndex>=this.getItems().length-1)return;this._highlightedIndex++;let e=this.$refs.menu.querySelector(`[data-index="${this._highlightedIndex}"]`);e.focus({preventScroll:!0}),(n(e)||h(e))&&r(e)},"@keydown.prevent.up"(){if(this._highlightedIndex<=0)return;this._highlightedIndex--;let e=this.$refs.menu.querySelector(`[data-index="${this._highlightedIndex}"]`);e.focus({preventScroll:!0}),(h(e)||n(e))&&r(e)},"@keydown.prevent.escape"(){this._isOpen&&this.close()},"@keydown.backspace"(){if(this._multiple&&this._selected.size&&this._externalValue===""){let e=this.getLastSelected();this._selected.delete(e),this.updateModel()}},"@update:value"(){this._externalValue=this.$event.detail,this.canOpenEmptyMenu()&&this.open()}}),this.$watch("_externalValue",()=>{this._noFilter||(this._filteredItems=this.filterItems())}),this.$watch("_items",()=>{this.open()}),this.$watch("_model",()=>{let e=new Map(this._selected);this._selected.clear(),this._model.forEach(i=>{let s=this._selectItems.find(u=>u.value===i)||e.get(i);s&&this._selected.set(s.value,s)})}),t.bind(this.$el,l.main)},transformItems(){if(!this._items.length){this._selectItems=[];return}typeof this._items[0]=="string"&&(this._selectItems=this._items.map(e=>({text:e,value:e,origin:null}))),typeof this._items[0]=="object"&&(this._selectItems=this._items.map(e=>({text:e[this._itemText],value:e[this._itemValue],origin:e})))},getLastSelected(){return Array.from(this._selected.keys()).pop()},filterItems(){return this._selectItems.filter(e=>e.text.indexOf(this._externalValue)!==-1)},getItems(){return this._noFilter?this._selectItems:this._externalValue===""?this._selectItems:this._filteredItems},canOpenEmptyMenu(){return!this._noEmptyOpen||this.getItems().length},open(){this._isOpen||!this._isFocused||(this._floating.startAutoUpdate(),this._isOpen=!0,this._selected.size?this.scrollToFirstSelected():this.$refs.menu.scrollTo(0,0),this._highlightedIndex=-1,this.$dispatch("open-selectmenu"))},scrollToFirstSelected(){let e=this.$refs.menu.querySelector("[data-selected]");e&&this.$nextTick(()=>e.scrollIntoView({block:"nearest"}))},close(){this._floating.destroy(),this._isOpen=!1},getSelected(){return[...this._selected].map(([e,i])=>i)},getSelectedValues(){return[...this._selected].map(([e,i])=>i.value)},select(){if(this._multiple)this._selected.has(this.item.value)?this._selected.delete(this.item.value):this._selected.set(this.item.value,this.item),this.updateModel();else{let e=this._selected.size&&this._selected.values().next().value;return e.value===this.item.value?this.item:(this._selected.set(this.item.value,this.item),e&&this._selected.delete(e.value),this.updateModel(),this.item)}},unselect(){this._selected.delete(this.selectedItem.value)},clearSelection(){this._selected.clear(),this.updateModel()},updateModel(){this._model=this.getSelectedValues()},isItemSelected(){return this._selected.has(this.item.value)},getHighlightedItemText(){return o(this.item.text,this._externalValue)},trigger:{"x-ref":"trigger","@mousedown"(){let{target:e}=this.$event;e.getAttribute("x-bind")!=="clearButton"&&this.canOpenEmptyMenu()&&this.open()},"@focusin"(){this._isFocused=!0;let e=this._selected.size&&this._selected.values().next().value;if(this._inputEl.style.opacity=1,this._multiple){this._externalValue="";return}e&&(this._externalValue=e.text)},"@focusout"(){this.$refs.menu.contains(this.$event.relatedTarget)||(this.close(),this._isFocused=!1,this._inputEl.style.opacity=0)},":data-clearable"(){return t.bound(this._selectEl,"data-clearable")},":data-use-loader"(){return t.bound(this._selectEl,"data-use-loader")},":data-is-loading"(){return t.bound(this._selectEl,"data-is-loading")},":data-placeholder"(){return t.bound(this._selectEl,"data-placeholder")},...l.trigger},menu:{"x-ref":"menu","x-show"(){return this._isOpen},"@mousedown.prevent"(){},"@focusout"(){this.$refs.menu.contains(this.$event.relatedTarget)||this.$event.relatedTarget!==this._inputEl&&(this.close(),this.$root.querySelector("[x-bind='input']").focus())},"@scroll.debounce"(){this.$el.offsetHeight+this.$el.scrollTop>=this.$el.scrollHeight&&this.$dispatch("scroll-to-bottom")},...l.menu},option:{"@click"(){let e=this.select();this._multiple||(this._externalValue=e.text),this._multiple||this.close()},"@keydown.prevent.enter"(){let e=this.select();this._multiple||(this._externalValue=e.text),this.close()},":class"(){let e=this.$el.attributes,i="";return this._selected.has(this.item.value)?i+=(e["class-selected"]?.textContent||"")+" ":i+=(e["class-default"]?.textContent||"")+" ",i},":data-selected"(){return this._selected.has(this.item.value)},":data-index"(){return this.index},...l.option},selectedItems:{"x-show"(){return this._multiple||!this._isFocused},":style"(){return this._multiple?{display:"contents"}:{position:"absolute"}}},indicator:{"@mousedown.prevent"(){this._isOpen&&(this.close(),this.$event.stopPropagation())}}}})}document.addEventListener("alpine:init",()=>{Alpine.plugin(a)});})();
