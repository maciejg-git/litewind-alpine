(()=>{function n(t){t.data("autocomplete",()=>{let s={main:{"x-id"(){return["select-aria"]}},trigger:{role:"combobox",":aria-expanded"(){return this.isOpen},":aria-controls"(){return this.$id("select-aria")}},menu:{":id"(){return this.$id("select-aria")},role:"listbox"},option:{role:"option",":aria-selected"(){return this.selected.has(this.item.value)?"true":"false"}}},l=e=>e.offsetTop+e.clientHeight>e.parentElement.scrollTop+e.parentElement.clientHeight,h=e=>e.offsetTop<e.parentElement.scrollTop,r=e=>{e.parentElement.scrollTo(0,e.offsetTop-e.parentElement.clientHeight/2+e.clientHeight/2)};return{isOpen:!1,floating:null,_value:"",_externalValue:"",selected:new Map,_items:[],_model:null,highlightedIndex:-1,selectEl:null,isFocused:!1,inputEl:null,items:[],multiple:!1,itemText:"text",itemValue:"value",noFilter:!1,init(){this.$nextTick(()=>{t.effect(()=>{this.items=t.bound(this.$el,"data-items")??this.items,this.transformItems()}),this.multiple=JSON.parse(t.bound(this.$el,"data-multiple")??this.multiple),this.itemText=t.bound(this.$el,"data-item-text")??this.itemText,this.itemValue=t.bound(this.$el,"data-item-value")??this.itemValue,this.noFilter=JSON.parse(t.bound(this.$el,"data-no-filter")??this.noFilter),this.floating=useFloating(this.$refs.trigger||this.$root.querySelector("[x-bind='trigger']"),this.$refs.menu,{resize:!0})}),this.selectEl=this.$el,this.inputEl=this.$el.querySelector("[x-bind='input']"),t.bind(this.$el,{"x-modelable":"_model","@keydown.prevent.down"(){if(this.isOpen||this.open(),this.highlightedIndex>=this._items.length-1)return;this.highlightedIndex++;let e=this.$refs.menu.querySelector(`[data-index="${this.highlightedIndex}"]`);e.focus({preventScroll:!0}),(l(e)||h(e))&&r(e)},"@keydown.prevent.up"(){if(this.highlightedIndex<=0)return;this.highlightedIndex--;let e=this.$refs.menu.querySelector(`[data-index="${this.highlightedIndex}"]`);e.focus({preventScroll:!0}),(h(e)||l(e))&&r(e)},"@keydown.prevent.escape"(){this.isOpen&&this.close()},"@keydown.backspace"(){if(this.multiple&&this.selected.size&&this._externalValue===""){let e=this.getLastSelected();this.selected.delete(e),this.updateModel()}},"@update:value"(){this._externalValue=this.$event.detail,this.isOpen||this.open()}}),t.bind(this.$el,s.main),this.$watch("_model",()=>{this.selected.clear(),this._model.forEach(e=>{let i=this._items.find(a=>a.value===e);i&&this.selected.set(i.value,i)})})},transformItems(){if(!this.items.length){this._items=[];return}typeof this.items[0]=="string"&&(this._items=this.items.map(e=>({text:e,value:e,origin:null}))),typeof this.items[0]=="object"&&(this._items=this.items.map(e=>({text:e[this.itemText],value:e[this.itemValue],origin:e})))},getLastSelected(){return Array.from(this.selected.keys()).pop()},getItems(){return this.noFilter?this._items:this._items.filter(e=>e.text.indexOf(this._externalValue)!==-1)},open(){this.floating.startAutoUpdate(),this.isOpen=!0,this.selected.size?this.scrollToFirstSelected():this.$refs.menu.scrollTo(0,0),this.highlightedIndex=-1,this.$dispatch("open-selectmenu")},scrollToFirstSelected(){let e=this.$refs.menu.querySelector("[data-selected]");e&&this.$nextTick(()=>e.scrollIntoView({block:"nearest"}))},close(){this.floating.destroy(),this.isOpen=!1},getSelected(){return[...this.selected].map(([e,i])=>i)},getSelectedValues(){return[...this.selected].map(([e,i])=>i.value)},select(){if(this.multiple)this.selected.has(this.item.value)?this.selected.delete(this.item.value):this.selected.set(this.item.value,this.item),this.updateModel();else{let e=this.selected.size&&this.selected.values().next().value;return e.value===this.item.value?this.item:(this.selected.set(this.item.value,this.item),e&&this.selected.delete(e.value),this.updateModel(),this.item)}},unselect(){this.selected.delete(this.selectedItem.value)},updateModel(){this._model=this.getSelectedValues()},isItemSelected(){return this.selected.has(this.item.value)},trigger:{"x-ref":"trigger","@mousedown"(){this.isOpen||this.open()},"@focusin"(){this.isFocused=!0;let e=this.selected.size&&this.selected.values().next().value;if(this.inputEl.style.opacity=1,this.inputEl.style.position="relative",this.multiple){this._externalValue="";return}e&&(this._externalValue=e.text)},"@focusout"(){this.$refs.menu.contains(this.$event.relatedTarget)||(this.close(),this.isFocused=!1,this.inputEl.style.opacity=0,this.inputEl.style.position="absolute")},":data-clearable"(){return t.bound(this.selectEl,"data-clearable")},":data-use-loader"(){return t.bound(this.selectEl,"data-use-loader")},":data-is-loading"(){return t.bound(this.selectEl,"data-is-loading")},":data-placeholder"(){return t.bound(this.selectEl,"data-placeholder")},...s.trigger},menu:{"x-ref":"menu","x-show"(){return this.isOpen},"@mousedown.prevent"(){},"@focusout"(){this.$refs.menu.contains(this.$event.relatedTarget)||this.$event.relatedTarget!==this.inputEl&&(this.close(),this.$root.querySelector("[x-bind='input']").focus())},"@scroll"(){this.$el.offsetHeight+this.$el.scrollTop+100>=this.$el.scrollHeight&&this.$dispatch("scroll-to-bottom")},...s.menu},option:{"@click"(){let e=this.select();this.multiple||(this._externalValue=e.text),this.multiple||this.close()},":class"(){let e=this.$el.attributes,i="";return this.selected.has(this.item.value)?i+=(e["class-selected"]?.textContent||"")+" ":i+=(e["class-default"]?.textContent||"")+" ",i},":data-selected"(){return this.selected.has(this.item.value)},":data-index"(){return this.index},...s.option}}})}document.addEventListener("alpine:init",()=>{Alpine.plugin(n)});})();
