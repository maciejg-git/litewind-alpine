(()=>{function h(i){i.data("table",()=>{let l=t=>t??"",o=t=>Object.prototype.toString.call(t)=="[object Date]",n=(t,e)=>t<e?-1:t>e?1:0,f=(t,e,r,a)=>(t=l(t),e=l(e),o(t)&&o(e)?n(t,e)*r:typeof t=="number"&&typeof e=="number"?isNaN(t)&&!isNaN(e)?-1:!isNaN(t)&&isNaN(e)?1:n(t,e)*r:a(t,e)*r),_=t=>t.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()),u=(t,e,r)=>(r=r||"match",(t+"").replace(new RegExp(`(${e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")})`,"i"),`<span class='${r}'>$1</span>`)),d={sortable:!1,filterable:!0,visible:!0},s=!1;return{_sortKey:"",_sortAsc:1,_sortedTableData:[],_tableData:[],_definition:[],_filter:"",_page:1,_itemsPerPage:0,_locale:"en-GB",_primaryKey:"",_onFilter:null,_isLoading:!1,init(){this.$nextTick(()=>{i.effect(()=>{let t=i.bound(this.$el,"data-items")??[];this._tableData=[...t],s=!0,this._sortKey="",this._sortAsc=1}),i.effect(()=>{this._definition=this.getDefinition()}),i.effect(()=>{this._filter=i.bound(this.$el,"data-filter")??this._filter,this._page=1}),i.effect(()=>{this._itemsPerPage=parseInt(i.bound(this.$el,"data-items-per-page")??this._itemsPerPage),this._page=1}),i.effect(()=>{this._locale=i.bound(this.$el,"data-locale")??this._locale}),i.effect(()=>{this._onFilter=i.bound(this.$el,"data-on-filter")??this._onFilter}),i.effect(()=>{this._page=parseInt(i.bound(this.$el,"data-page")??this._page)}),i.effect(()=>{this._isLoading=JSON.parse(i.bound(this.$el,"data-is-loading")??this._isLoading)}),this._primaryKey=i.bound(this.$el,"data-primary-key")??this._primaryKey,this.$watch("_sortKey",()=>{s=!0}),this.$watch("_sortAsc",()=>{s=!0}),i.bind(this.$el,{":class"(){let t=this.$el.attributes,e="";return this._isLoading&&(e=t["class-loading"]?.textContent||""),e}})})},generateDefinitionFromData(){return!this._tableData||!this._tableData.length?[]:Object.keys(this._tableData[0]).map(t=>({key:t}))},getUserDefinition(){let t=i.bound(this.$el,"data-definition");return Array.isArray(t)?t.every(e=>e.key)&&t:!1},getDefinition(){return(this.getUserDefinition()||this.generateDefinitionFromData()).map(e=>({...d,...e,label:e.label||_(e.key)}))},getDataSorted(){if(!this._sortKey)return this._tableData;if(!s)return this._sortedTableData;s=!1;let t=new Intl.Collator(this._locale).compare;return this._sortedTableData=[...this._tableData].sort((e,r)=>f(e[this._sortKey],r[this._sortKey],this._sortAsc,t)),this._sortedTableData},getFilterableKeys(){return this._definition.filter(t=>t.filterable!==!1&&t.visible!==!1).map(t=>t.key)},getDataFiltered(){if(!this._filter)return this.getDataSorted();let t=new RegExp(this._filter.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),"i"),e=this.getFilterableKeys();return this.getDataSorted().filter(a=>e.some(c=>(a[c]+"").search(t)!==-1))},getDataPaginated(){let t=this.getDataFiltered();return typeof this._onFilter=="function"&&this._onFilter(t),this.$nextTick(()=>{this.$dispatch("update:items",t)}),this._itemsPerPage?t.slice((this._page-1)*this._itemsPerPage,this._page*this._itemsPerPage):t},getCellContent(){return this.row[this.col.key]},getHighlightedCellContent(){return u(this.row[this.col.key],this._filter)},isSortable(){return this.col.sortable},isSorted(){return this._sortKey===this.col.key},isSortedAsc(){return this.isSorted()&&this._sortAsc===1},isSortedDesc(){return this.isSorted()&&this._sortAsc===-1},header:{"@click"(){this.isSortable()&&(this._sortAsc=this._sortKey===this.col.key?-this._sortAsc:1,this._sortKey=this.col.key)},":class"(){return this.isSortable()?"cursor-pointer":""}}}})}document.addEventListener("alpine:init",()=>{Alpine.plugin(h)});})();
